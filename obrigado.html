<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Obrigado! | Sicred Financeira</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- (seu script kwai e config tailwind já presentes no original) -->
    
    <script>
        // Exemplo do SDK (mantive o load do kwai que você já tinha)
        !function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.install=t():e.install=t()}("undefined"!=typeof window?window:self,(function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=72)}({72:function(e,t,n){"use strict";var o=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){var o,i=e.createElement("script");i.type="text/javascript",i.async=!0,i.src=t,n&&(i.onerror=function(){r(e,n)});var a=e.getElementsByTagName("script")[0];null===(o=a.parentNode)||void 0===o||o.insertBefore(i,a)};!function(e,t,n){e.KwaiAnalyticsObject=n;var i=e[n]=e[n]||[];i.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"];var a=function(e,t){e[t]=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=o([t],n,!0);e.push(i)}};i.methods.forEach((function(e){a(i,e)})),i.instance=function(e){var t,n=(null===(t=i._i)||void 0===t?void 0:t[e])||[];return i.methods.forEach((function(e){a(n,e)})),n},i.load=function(e,o){var a="https://s21-def.ap4r.com/kos/s101/nlav112572/pixel/events.js";i._i=i._i||{},i._i[e]=[],i._i[e]._u=a,i._t=i._t||{},i._t[e]=+new Date,i._o=i._o||{},i._o[e]=o||{};var c="?sdkid=".concat(e,"&lib=").concat(n);r(t,a+c,"https://s21-def.ks-la.net/kos/s101/nlav112572/pixel/events.js"+c)}}(window,document,"kwaiq")}})}));
    </script>
    <script>
        // Se for usar o pixel, mantenha seu id
        if (window.kwaiq && typeof kwaiq.load === 'function') {
            kwaiq.load('287101758925323');
            kwaiq.page && kwaiq.page();
            kwaiq.track && kwaiq.track('completeRegistration');
        }
    </script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            DEFAULT: '#33820D',
                            dark: '#2a6b0b',
                            light: '#eaf3e7'
                        },
                        neutral: {
                            DEFAULT: '#111827',
                            light: '#f9fafb',
                            medium: '#6b7280'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-neutral-light font-sans flex items-center justify-center min-h-screen p-6">

    <main class="container bg-white max-w-xl text-center p-10 rounded-2xl shadow-xl">
        <div class="w-20 h-20 mx-auto mb-6 border-4 border-brand rounded-full flex justify-center items-center">
            <svg class="w-10 h-10 stroke-brand" viewBox="0 0 52 52" style="stroke-width: 5; stroke-linecap: round; stroke-linejoin: round;">
                <path fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
            </svg>
        </div>

        <h1 class="text-3xl md:text-4xl font-bold text-neutral-DEFAULT mb-4">
            Cadastro recebido!
        </h1>
        <p class="text-lg text-neutral-medium leading-relaxed mb-8">
            Para agilizar seu atendimento, clique no botão abaixo ou aguarde para ser redirecionado(a) para nosso WhatsApp.
        </p>
        
        <a id="whatsapp-button" href="#" class="inline-block bg-brand hover:bg-brand-dark text-white font-bold py-3 px-8 rounded-full transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1 text-lg" target="_blank" rel="noopener noreferrer">
            <i class="fab fa-whatsapp mr-2"></i>
            Falar com um especialista
        </a>

        <div class="mt-8 text-sm text-neutral-medium/80">
            Redirecionando para o WhatsApp em <span id="countdown" class="font-semibold">5</span> segundos...
        </div>
    </main>

    <script>
    (function() {
        // --- 1. CONFIGURE AQUI OS DESTINATÁRIOS ---
        // Formato: '55' + DDD + número (sem espaços)
        const recipients = [
            '5511950234915', // Especialista 1
            '5511953382452', // Especialista 2
            // adicione mais números aqui
        ];

        // --- 2. MENSAGEM PADRÃO ---
        const message = 'Olá! Vi o anúncio da Sicred Financeira e gostaria de saber mais sobre as opções de crédito.';

        // --- 3. CHAVES NO localStorage ---
        const queueKey = 'leadQueue_sicred_v1'; // versão no nome para forçar reset se mudar lógica
        const queueMetaKey = 'leadQueue_meta_sicred_v1'; // guarda metadados (ex: hash do array)

        // --- 4. FUNÇÕES AUXILIARES ---
        function supportsLocalStorage() {
            try {
                const key = '__test_ls__';
                localStorage.setItem(key, key);
                localStorage.removeItem(key);
                return true;
            } catch (e) {
                return false;
            }
        }

        // gera um hash simples (para detectar mudança de lista)
        function simpleHash(str) {
            let h = 0;
            for (let i = 0; i < str.length; i++) {
                h = ((h << 5) - h) + str.charCodeAt(i);
                h |= 0;
            }
            return String(h);
        }

        // Fisher-Yates shuffle
        function shuffle(array) {
            const a = array.slice();
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        }

        // Cria fila embaralhada de índices [0..n-1]
        function createShuffledQueue(n) {
            const indices = Array.from({length: n}, (_, i) => i);
            return shuffle(indices);
        }

        // Recupera a queue do localStorage; se não existir, cria e salva nova
        function getQueue() {
            if (!supportsLocalStorage()) {
                return createShuffledQueue(recipients.length);
            }

            const recipientsHash = simpleHash(JSON.stringify(recipients));
            const meta = JSON.parse(localStorage.getItem(queueMetaKey) || 'null');

            let queue = JSON.parse(localStorage.getItem(queueKey) || 'null');

            // Se não existe ou os recipients mudaram, cria nova fila
            if (!queue || !Array.isArray(queue) || !meta || meta.hash !== recipientsHash) {
                queue = createShuffledQueue(recipients.length);
                localStorage.setItem(queueKey, JSON.stringify(queue));
                localStorage.setItem(queueMetaKey, JSON.stringify({hash: recipientsHash}));
            }

            return queue;
        }

        // Pop o próximo índice da queue, atualiza e salva de volta.
        function popNextIndex() {
            if (!supportsLocalStorage()) {
                // fallback: retorna índice aleatório (sem persistência)
                return Math.floor(Math.random() * recipients.length);
            }

            let queue = getQueue();

            // Se por algum motivo a fila ficou vazia, recria nova fila
            if (!queue || queue.length === 0) {
                queue = createShuffledQueue(recipients.length);
            }

            // pega o primeiro elemento
            const nextIndex = queue.shift();

            // salva a fila atualizada
            localStorage.setItem(queueKey, JSON.stringify(queue));

            // se fila ficar vazia após remover, ela será recriada na próxima chamada getQueue()
            return nextIndex;
        }

        // --- 5. OBTER NÚMERO ESCOLHIDO E MONTAR URL ---
        const chosenIndex = popNextIndex();
        const phoneNumber = recipients[chosenIndex] || recipients[0]; // fallback seguro
        const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;

        // atualiza botão
        const button = document.getElementById('whatsapp-button');
        if (button) {
            button.href = whatsappUrl;
        }

        // contador e redirecionamento
        let seconds = 5;
        const countdownElement = document.getElementById('countdown');

        if (countdownElement) countdownElement.textContent = String(seconds);

        const interval = setInterval(() => {
            seconds--;
            if (countdownElement) {
                countdownElement.textContent = String(Math.max(0, seconds));
            }

            if (seconds <= 0) {
                clearInterval(interval);
                // abre em nova aba/janela (com target _blank no link) para preservar a página
                window.location.href = whatsappUrl;
            }
        }, 1000);

        // Opcional: registra no console qual índice foi escolhido (útil para debug)
        console.log('Lead atribuído ao índice:', chosenIndex, 'número:', phoneNumber);
    })();
    </script>
</body>
</html>
